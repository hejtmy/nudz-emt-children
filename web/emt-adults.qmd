---
title: "VR EMT and RRBANS results for adults"
format: html
---

```{r setup, echo=FALSE, warning=FALSE, message=FALSE, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning=FALSE)
library(tidyverse)
library(gt)
library(papaja)
library(report)
here::i_am("web/emt-adults.qmd")
```

```{r data loading, results="hide"}
source(here::here("scripts/loading-adults.R"), encoding = "UTF-8")
```

## Sessions

All participants from the HCE group had the House as the second session. 

```{r session descriptives}
df_emt_adults %>%
  distinct(bindingid, Environment, Session) %>%
  count(Environment, Session)
```

## Participant descriptives

```{r participant descriptives}
report_participants(df_emt_adults)
```

```{r descriptives}
df_emt_adults %>%
  group_by(difficulty, error_type ) %>%
  select(errors) %>%
  report_table() %>%
  select(Group, Mean, SD, Median) %>%
  gt() %>%
    tab_header(title = "Descriptives of errors") %>%
    fmt_number(columns = vars(Mean, SD), decimals = 3) 
```

```{r descriptives plot}
ggplot(df_emt_adults, aes(relative_error_value, fill = Environment)) +
  geom_histogram(position = position_dodge(), binwidth = 0.1) +
  geom_density(alpha = 0.2) +
  facet_grid(rows = vars(error_type), cols = vars(difficulty), scales = "free_x")
```

## Correlation between performance and RBANS

```{r RBANS A 1 emt plots}
ggplot(df_emt_adults, aes(RBANS.A.1, relative_error_value, color = Environment)) +
  geom_jitter(width = 0.2, height = 0.1) +
  geom_smooth(method = "lm") +
  facet_grid(col = vars(difficulty), rows = vars(error_type), scales = "free_y")  +
  labs(x = "RBANS A 1", y = "Relative error value", title = "Correlation between RBANS 1 and EMT") +
  theme(legend.position = "bottom", text = element_text(size=20))
```

```{r RBANS A 2 emt plots}
ggplot(df_emt_adults, aes(RBANS.A.2, relative_error_value, color = Environment)) +
  geom_jitter(width = 0.2, height = 0.1) +
  geom_smooth(method = "lm") +
  facet_grid(col = vars(difficulty), rows = vars(error_type), scales = "free_y")  +
  labs(x = "RBANS A 2", y = "Relative error value", title = "Correlation between RBANS 2 and EMT") +
  theme_apa() +
  theme(legend.position = "bottom", text = element_text(size=20))
```

```{r}
df_emt_adults %>%
  #filter(Environment == "House") %>%
  pivot_longer(c(RBANS.A.1, RBANS.A.2), names_to = "RBANS", values_to = "RBANS_value") %>%
  group_by(Environment, error_type, difficulty,RBANS) %>%
  group_modify(~broom::tidy(cor.test(.$RBANS_value, .$errors, method = "spearman"))) %>%
  summarise(result = str_glue("r = {round(estimate, 3)} (p = {apa_p(p.value)})")) %>%
  pivot_wider(names_from = RBANS, values_from = result) %>%
  ungroup() %>%
  gt() %>%
  tab_header(title = "Correlation between RBANS and EMT for house environment",
             subtitle = "Spearman's rho, not corrected for multiple comparisons")
```


```{r}
df_emt_adults %>%
  filter(error_type == "incorect_placement") %>%
  group_by(difficulty) %>%
  group_modify(~broom::tidy(t.test(.$errors ~ .$Environment)))
```